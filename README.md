# Sequel::Instrumentation

This gem provides OpenTracing instrumentation for [Sequel](https://github.com/jeremyevans/sequel) using `Dataset` and `Database` extensions.

## Installation

Add this line to your application's Gemfile:

```ruby
gem 'sequel-instrumentation'
```

And then execute:

    $ bundle

Or install it yourself as:

    $ gem install sequel-instrumentation

## Usage

```ruby
require 'sequel/instrumentation'

Sequel::Instrumentation.instrument(tracer: OpenTracing.global_tracer)
```

Optional argument:
- `tracer`: used to set a custom tracer. Default: `OpenTracing.global_tracer`

## Tags

Each span generated by the instrumentation will have the following tags:
- `component`: `ruby-sequel`
- `span.kind`: `client`
- `db.type`: the database driver type. For example, `mysql2`
- `db.statement`: the SQL statement being executed

When possible, the `db.instance` tag will also be populated with the database name.

## Development

After checking out the repo, run `bin/setup` to install dependencies. You can also run `bin/console` for an interactive prompt that will allow you to experiment.

To install this gem onto your local machine, run `bundle exec rake install`. To release a new version, update the version number in `version.rb`, and then run `bundle exec rake release`, which will create a git tag for the version, push git commits and tags, and push the `.gem` file to [rubygems.org](https://rubygems.org).

## Contributing

Bug reports and pull requests are welcome on GitHub at https://github.com/signalfx/ruby-sequel-instrumentation.
